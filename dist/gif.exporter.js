(function () {
	'use strict';

	var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
	    return new (P || (P = Promise))(function (resolve, reject) {
	        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
	        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
	        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
	        step((generator = generator.apply(thisArg, _arguments || [])).next());
	    });
	};
	var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
	    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
	    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
	    function verb(n) { return function (v) { return step([n, v]); }; }
	    function step(op) {
	        if (f) throw new TypeError("Generator is already executing.");
	        while (_) try {
	            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
	            if (y = 0, t) op = [op[0] & 2, t.value];
	            switch (op[0]) {
	                case 0: case 1: t = op; break;
	                case 4: _.label++; return { value: op[1], done: false };
	                case 5: _.label++; y = op[1]; op = [0]; continue;
	                case 7: op = _.ops.pop(); _.trys.pop(); continue;
	                default:
	                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
	                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
	                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
	                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
	                    if (t[2]) _.ops.pop();
	                    _.trys.pop(); continue;
	            }
	            op = body.call(thisArg, _);
	        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
	        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
	    }
	};

}());

ENV_WORKER="var GIFExporter=function(t){\"use strict\";function i(s,e){var r,h,n,t,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return t={next:i(0),throw:i(1),return:i(2)},\"function\"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function i(i){return function(t){return function(i){if(r)throw new TypeError(\"Generator is already executing.\");for(;a;)try{if(r=1,h&&(n=2&i[0]?h.return:i[0]?h.throw||((n=h.return)&&n.call(h),0):h.next)&&!(n=n.call(h,i[1])).done)return n;switch(h=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,h=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=0<(n=a.trys).length&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(s,a)}catch(t){i=[6,t],h=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,t])}}}var x,s=function(){function t(t,i){var s;this.ncycles=100,this.netsize=256,this.maxnetpos=this.netsize-1,this.netbiasshift=4,this.intbiasshift=16,this.intbias=1<<this.intbiasshift,this.gammashift=10,this.gamma=1<<this.gammashift,this.betashift=10,this.beta=this.intbias>>this.betashift,this.betagamma=this.intbias<<this.gammashift-this.betashift,this.initrad=this.netsize>>3,this.radiusbiasshift=6,this.radiusbias=1<<this.radiusbiasshift,this.initradius=this.initrad*this.radiusbias,this.radiusdec=30,this.alphabiasshift=10,this.initalpha=1<<this.alphabiasshift,this.radbiasshift=8,this.radbias=1<<this.radbiasshift,this.alpharadbshift=this.alphabiasshift+this.radbiasshift,this.alpharadbias=1<<this.alpharadbshift,this.prime1=499,this.prime2=491,this.prime3=487,this.prime4=503,this.minpicturebytes=3*this.prime4,this.network=[],this.netindex=[],this.bias=[],this.freq=[],this.radpower=[],this.pixels=t,this.samplefac=i;for(var e=0;e<this.netsize;e++)s=(e<<this.netbiasshift+8)/this.netsize,this.network[e]=[s,s,s],this.freq[e]=this.intbias/this.netsize,this.bias[e]=0}return t.prototype.toInt=function(t){return~~t},t.prototype.unbiasnet=function(){for(var t=0;t<this.netsize;t++)this.network[t][0]>>=this.netbiasshift,this.network[t][1]>>=this.netbiasshift,this.network[t][2]>>=this.netbiasshift,this.network[t][3]=t},t.prototype.altersingle=function(t,i,s,e,r){this.network[i][0]-=t*(this.network[i][0]-s)/this.initalpha,this.network[i][1]-=t*(this.network[i][1]-e)/this.initalpha,this.network[i][2]-=t*(this.network[i][2]-r)/this.initalpha},t.prototype.alterneigh=function(t,i,s,e,r){for(var h,n,a=Math.abs(i-t),o=Math.min(i+t,this.netsize),c=i+1,u=i-1,f=1;c<o||a<u;)n=this.radpower[f++],c<o&&((h=this.network[c++])[0]-=n*(h[0]-s)/this.alpharadbias,h[1]-=n*(h[1]-e)/this.alpharadbias,h[2]-=n*(h[2]-r)/this.alpharadbias),a<u&&((h=this.network[u--])[0]-=n*(h[0]-s)/this.alpharadbias,h[1]-=n*(h[1]-e)/this.alpharadbias,h[2]-=n*(h[2]-r)/this.alpharadbias)},t.prototype.contest=function(t,i,s){var e,r,h,n,a,o=~(1<<31),c=o,u=-1,f=u;for(e=0;e<this.netsize;e++)r=this.network[e],(h=Math.abs(r[0]-t)+Math.abs(r[1]-i)+Math.abs(r[2]-s))<o&&(o=h,u=e),(n=h-(this.bias[e]>>this.intbiasshift-this.netbiasshift))<c&&(c=n,f=e),a=this.freq[e]>>this.betashift,this.freq[e]-=a,this.bias[e]+=a<<this.gammashift;return this.freq[u]+=this.beta,this.bias[u]-=this.betagamma,f},t.prototype.inxbuild=function(){var t,i,s,e,r,h,n=0,a=0;for(t=0;t<this.netsize;t++){for(r=t,h=(s=this.network[t])[1],i=t+1;i<this.netsize;i++)(e=this.network[i])[1]<h&&(r=i,h=e[1]);if(e=this.network[r],t!=r&&(i=e[0],e[0]=s[0],s[0]=i,i=e[1],e[1]=s[1],s[1]=i,i=e[2],e[2]=s[2],s[2]=i,i=e[3],e[3]=s[3],s[3]=i),h!=n){for(this.netindex[n]=a+t>>1,i=n+1;i<h;i++)this.netindex[i]=t;n=h,a=t}}for(this.netindex[n]=a+this.maxnetpos>>1,i=n+1;i<256;i++)this.netindex[i]=this.maxnetpos},t.prototype.lookupRGB=function(t,i,s){for(var e,r,h,n=1e3,a=-1,o=this.netindex[i],c=o-1;o<this.netsize||0<=c;)o<this.netsize&&(n<=(h=(r=this.network[o])[1]-i)?o=this.netsize:(o++,h<0&&(h=-h),(e=r[0]-t)<0&&(e=-e),(h+=e)<n&&((e=r[2]-s)<0&&(e=-e),(h+=e)<n&&(n=h,a=r[3])))),0<=c&&(n<=(h=i-(r=this.network[c])[1])?c=-1:(c--,h<0&&(h=-h),(e=r[0]-t)<0&&(e=-e),(h+=e)<n&&((e=r[2]-s)<0&&(e=-e),(h+=e)<n&&(n=h,a=r[3]))));return a},t.prototype.learn=function(){var t,i,s,e,r,h,n=this.pixels.length,a=this.toInt(30+(this.samplefac-1)/3),o=this.toInt(n/(3*this.samplefac)),c=this.toInt(o/this.ncycles),u=this.initalpha,f=this.initradius,p=f>>this.radiusbiasshift;for(p<=1&&(p=0),t=0;t<p;t++)this.radpower[t]=this.toInt(u*((p*p-t*t)*this.radbias/(p*p)));n<this.minpicturebytes?(this.samplefac=1,i=3):i=n%this.prime1!=0?3*this.prime1:n%this.prime2!=0?3*this.prime2:n%this.prime3!=0?3*this.prime3:3*this.prime4;var l=0;for(t=0;t<o;)if(s=(255&this.pixels[l])<<this.netbiasshift,e=(255&this.pixels[l+1])<<this.netbiasshift,r=(255&this.pixels[l+2])<<this.netbiasshift,h=this.contest(s,e,r),this.altersingle(u,h,s,e,r),0!==p&&this.alterneigh(p,h,s,e,r),n<=(l+=i)&&(l-=n),0===c&&(c=1),++t%c==0)for(u-=u/a,(p=(f-=f/this.radiusdec)>>this.radiusbiasshift)<=1&&(p=0),h=0;h<p;h++)this.radpower[h]=this.toInt(u*((p*p-h*h)*this.radbias/(p*p)))},t.prototype.buildColormap=function(){this.learn(),this.unbiasnet(),this.inxbuild()},t.prototype.getColormap=function(){for(var t=[],i=[],s=0;s<this.netsize;s++)i[this.network[s][3]]=s;for(var e=0,r=0;r<this.netsize;r++){var h=i[r];t[e++]=this.network[h][0],t[e++]=this.network[h][1],t[e++]=this.network[h][2]}return t},t}(),C=function(){function t(t){this._colorTable=[],this._GCT=[],this._distribution=51,this._colorLookup={},this._neuQuant=new s(t,20),this._neuQuant.buildColormap(),this._colorTable=this._neuQuant.getColormap()}return t.prototype.generate=function(){var e=this,r=\"\",h=0;return this._colorTable.forEach(function(t,i,s){if(r+=e.pad(t),(i+1)%3==0&&(e._GCT.push(r),e._colorLookup[r]=h,h++,r=\"\"),i===e._colorTable.length-1)return[e._colorLookup,e._GCT]}),[this._colorLookup,this._GCT]},t.prototype.lookupRGB=function(t){var i=parseInt(t.substr(0,2),16),s=parseInt(t.substr(2,2),16),e=parseInt(t.substr(4,2),16);return this._neuQuant.lookupRGB(i,s,e)},t.prototype.pad=function(t){return t<16?\"0\"+t.toString(16):t.toString(16)},t}(),e=function(){function t(){this.data=[]}return t.prototype.get=function(){return this.data},t.prototype.write=function(t){this.data.push(t)},t.prototype.writeArray=function(t,i){for(var s=0;s<i;s++)this.write(t[s])},t.prototype.writeUTF=function(t){for(var i=0;i<t.length;i++)this.write(t.charCodeAt(i))},t.prototype.writeColor=function(t){for(var i=0;i<t.length;i+=2){var s=parseInt(t[i]+t[i+1],16);this.write(s)}},t.prototype.writeLittleEndian=function(t){this.write(255&t),this.write(t>>8&255)},t.prototype.reset=function(){this.data=[]},t}(),r=function(){function t(t,i,s,e){this.EOF=1,this.BITS=12,this.HSIZE=5003,this._maxbits=this.BITS,this._maxmaxcode=1<<this.BITS,this._htab=[],this._codetab=[],this._hsize=this.HSIZE,this._free_ent=0,this._clear_flg=!1,this._cur_accum=0,this._cur_bits=0,this._masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],this._accum=[],this._imgW=t,this._imgH=i,this._pixels=s,this._initCodeSize=Math.max(2,e)}return t.prototype.writeCharToPacket=function(t,i){this._accum[this._a_count++]=t,254<=this._a_count&&this.flush_char(i)},t.prototype.cl_block=function(t){this.cl_hash(this._hsize),this._free_ent=this._ClearCode+2,this._clear_flg=!0,this.output(this._ClearCode,t)},t.prototype.cl_hash=function(t){for(var i=0;i<t;++i)this._htab[i]=-1},t.prototype.compress=function(t,i){var s,e,r,h,n,a,o;for(this._g_init_bits=t,this._clear_flg=!1,this._n_bits=this._g_init_bits,this._maxcode=this.MAXCODE(this._n_bits),this._ClearCode=1<<t-1,this._EOFCode=this._ClearCode+1,this._free_ent=this._ClearCode+2,this._a_count=0,h=this.nextPixel(),o=0,s=this._hsize;s<65536;s*=2)++o;o=8-o,a=this._hsize,this.cl_hash(a),this.output(this._ClearCode,i);t:for(;(r=this.nextPixel())!=this.EOF;)if(s=(r<<this._maxbits)+h,e=r<<o^h,this._htab[e]!=s){if(0<=this._htab[e]){n=a-e,0===e&&(n=1);do{if((e-=n)<0&&(e+=a),this._htab[e]==s){h=this._codetab[e];continue t}}while(0<=this._htab[e])}this.output(h,i),h=r,this._free_ent<this._maxmaxcode?(this._codetab[e]=this._free_ent++,this._htab[e]=s):this.cl_block(i)}else h=this._codetab[e];this.output(h,i),this.output(this._EOFCode,i)},t.prototype.encode=function(t){t.write(this._initCodeSize),this._remaining=this._imgW*this._imgH,this._curPixel=0,this.compress(this._initCodeSize+1,t),t.write(0)},t.prototype.flush_char=function(t){0<this._a_count&&(t.write(this._a_count),t.writeArray(this._accum,this._a_count),this._a_count=0)},t.prototype.MAXCODE=function(t){return(1<<t)-1},t.prototype.nextPixel=function(){return 0===this._remaining?this.EOF:(--this._remaining,255&this._pixels[this._curPixel++])},t.prototype.output=function(t,i){for(this._cur_accum&=this._masks[this._cur_bits],0<this._cur_bits?this._cur_accum|=t<<this._cur_bits:this._cur_accum=t,this._cur_bits+=this._n_bits;8<=this._cur_bits;)this.writeCharToPacket(255&this._cur_accum,i),this._cur_accum>>=8,this._cur_bits-=8;if((this._free_ent>this._maxcode||this._clear_flg)&&(this._clear_flg?(this._maxcode=this.MAXCODE(this._n_bits=this._g_init_bits),this._clear_flg=!1):(++this._n_bits,this._n_bits==this._maxbits?this._maxcode=this._maxmaxcode:this._maxcode=this.MAXCODE(this._n_bits))),t==this._EOFCode){for(;0<this._cur_bits;)this.writeCharToPacket(255&this._cur_accum,i),this._cur_accum>>=8,this._cur_bits-=8;this.flush_char(i)}},t}(),h=function(){function t(){this.stream=new e,this.frameCount=0,console.log(\"Generator now running...\")}return t.prototype.init=function(t,i,s){this.reset(),this.width=t,this.height=i,this.GCT=s,this.writeHeader(),this.writeLogicalScreenDescriptor(),this.writeGlobalColorTable(),this.writeApplicationExtension()},t.prototype.generateFrame=function(t){this.frameIndexedPixels=t,this.frameCount+=1,console.log(\"generating frame \"+this.frameCount),this.writeGraphicControlExtension(),this.writeImageDescriptor(),this.writeImageData()},t.prototype.getStream=function(){return this.writeTrailer(),this.stream.get()},t.prototype.writeHeader=function(){this.stream.writeUTF(\"GIF89a\")},t.prototype.writeLogicalScreenDescriptor=function(){this.stream.writeLittleEndian(this.width),this.stream.writeLittleEndian(this.height),this.stream.write(247),this.stream.write(0),this.stream.write(0)},t.prototype.writeGlobalColorTable=function(){var i=this,s=0;this.GCT.forEach(function(t){s+=3,i.stream.writeColor(t)});for(var t=s;t<768;t++)this.stream.write(0)},t.prototype.writeApplicationExtension=function(){this.stream.write(33),this.stream.write(255),this.stream.write(11),this.stream.writeUTF(\"NETSCAPE2.0\"),this.stream.write(3),this.stream.write(1),this.stream.writeLittleEndian(0),this.stream.write(0)},t.prototype.writeGraphicControlExtension=function(){this.stream.write(33),this.stream.write(249),this.stream.write(4),this.stream.write(4),this.stream.writeLittleEndian(9),this.stream.write(0),this.stream.write(0)},t.prototype.writeImageDescriptor=function(){this.stream.write(44),this.stream.writeLittleEndian(0),this.stream.writeLittleEndian(0),this.stream.writeLittleEndian(this.width),this.stream.writeLittleEndian(this.height),this.stream.write(0)},t.prototype.writeImageData=function(){return h=this,o=function(){return i(this,function(t){return new r(this.width,this.height,this.frameIndexedPixels,8).encode(this.stream),console.log(\"completed frame \"+this.frameCount),[2]})},new((a=n=void 0)||(a=Promise))(function(t,i){function s(t){try{r(o.next(t))}catch(t){i(t)}}function e(t){try{r(o.throw(t))}catch(t){i(t)}}function r(i){i.done?t(i.value):new a(function(t){t(i.value)}).then(s,e)}r((o=o.apply(h,n||[])).next())});var h,n,a,o},t.prototype.writeTrailer=function(){this.stream.write(59),console.log(\"Generator now finished.\"),this.frameCount=0},t.prototype.writeLocalColorTable=function(){},t.prototype.writePlainTextExtension=function(){},t.prototype.writeCommentExtension=function(){},t.prototype.reset=function(){this.stream.reset(),this.frameCount=0},t}(),k=self,v=new h,E=[];function G(t,i,s){return a=[],o=[],t.forEach(function(t){var i,e,r,s=(i=t.filter(function(t,i){return(i+1)%4!=0}),e=[],r=\"\",i.forEach(function(t,i){var s;r+=(s=t)<16?\"0\"+s.toString(16):s.toString(16),(i+1)%3==0&&(e.push(r),r=\"\")}),{numericalRGBData:i,stringRGBData:e}),h=s.numericalRGBData,n=s.stringRGBData;a.push(h),o.push(n)}),{numericalRGBFrames:a,stringRGBFrames:o};var a,o}function T(t,i){var e;return(e=[],t.forEach(function(t,i){var s=[];t.forEach(function(t){var i;s.push((i=t,x.lookupRGB(i)))}),e.push(s)}),e).forEach(function(t){v.generateFrame(t)}),v.getStream()}return onmessage=function(t){var i,s,e,r,h,n,a,o,c,u=t.data,f=u.job,p=u.params;switch(f){case\"createGIF\":var l=p.width,_=p.height,m=G(E),b=m.numericalRGBFrames,w=m.stringRGBFrames,d=b.filter(function(t,i){return(i+1)%5==0}).reduce(function(t,i){var s=new Uint8Array(t.length+i.length);return s.set(t),s.set(i,t.length),s},new Uint8Array([])),g=(s=l,e=_,h=(r=(x=new C(d)).generate())[0],n=r[1],a=n,o=s,c=e,v.init(o,c,a),T(w));k.postMessage(g);break;case\"collectFrames\":var y=p.frame;i=y,E.push(new Uint8Array(i))}},t.NeuQuant=s,t.ColorTableGenerator=C,t.EncodedImage=e,t.LZWEncoder=r,t.GIFGenerator=h,t}({});";